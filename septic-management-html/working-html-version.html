<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Septic Tank Management System</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .icon {
            width: 1rem;
            height: 1rem;
            display: inline-block;
            vertical-align: middle;
            margin-right: 0.25rem;
        }
        .icon-plus::before { content: "‚ûï"; }
        .icon-search::before { content: "üîç"; }
        .icon-bell::before { content: "üîî"; }
        .icon-map::before { content: "üó∫Ô∏è"; }
        .icon-warning::before { content: "‚ö†Ô∏è"; }
        .icon-mail::before { content: "üìß"; }
        .icon-edit::before { content: "‚úèÔ∏è"; }
        .icon-delete::before { content: "üóëÔ∏è"; }
        .icon-x::before { content: "‚ùå"; }
        .icon-settings::before { content: "‚öôÔ∏è"; }
        .icon-upload::before { content: "üì§"; }
        .icon-download::before { content: "üì•"; }
    </style>
</head>
<body class="bg-gray-50">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const SepticManagementSystem = () => {
            const [jobs, setJobs] = useState([
                {
                    id: 1,
                    customerName: "John Smith",
                    address: "123 Oak Street, Springfield",
                    lat: 39.7817,
                    lng: -89.6501,
                    lastServiceDate: "2024-03-15",
                    serviceInterval: 24,
                    phone: "(555) 123-4567",
                    email: "john.smith@email.com",
                    tankSize: "1000 gallons",
                    notes: "Grease trap needs attention"
                },
                {
                    id: 2,
                    customerName: "Mary Johnson",
                    address: "456 Pine Avenue, Springfield",
                    lat: 39.7850,
                    lng: -89.6480,
                    lastServiceDate: "2024-06-20",
                    serviceInterval: 36,
                    phone: "(555) 987-6543",
                    email: "mary.johnson@email.com",
                    tankSize: "1500 gallons",
                    notes: "Easy access, preferred morning appointments"
                },
                {
                    id: 3,
                    customerName: "Bob Wilson",
                    address: "789 Maple Drive, Springfield",
                    lat: 39.7890,
                    lng: -89.6520,
                    lastServiceDate: "2023-12-10",
                    serviceInterval: 18,
                    phone: "(555) 456-7890",
                    email: "bob.wilson@email.com",
                    tankSize: "750 gallons",
                    notes: "Heavy usage, monitor closely"
                }
            ]);

            const [showAddForm, setShowAddForm] = useState(false);
            const [editingJob, setEditingJob] = useState(null);
            const [selectedJob, setSelectedJob] = useState(null);
            const [searchTerm, setSearchTerm] = useState('');
            const [showEmailSettings, setShowEmailSettings] = useState(false);

            // Search functionality
            const filteredJobs = jobs.filter(job => {
                const searchLower = searchTerm.toLowerCase();
                return job.customerName.toLowerCase().includes(searchLower) ||
                       job.address.toLowerCase().includes(searchLower) ||
                       job.phone.includes(searchTerm) ||
                       job.email.toLowerCase().includes(searchLower) ||
                       job.notes.toLowerCase().includes(searchLower);
            });

            const calculateServiceInfo = (lastServiceDate, serviceInterval) => {
                const lastDate = new Date(lastServiceDate);
                const nextDate = new Date(lastDate);
                nextDate.setMonth(nextDate.getMonth() + serviceInterval);
                
                const today = new Date();
                const daysUntilService = Math.ceil((nextDate - today) / (1000 * 60 * 60 * 24));
                
                let urgency = 'normal';
                if (daysUntilService < 0) urgency = 'overdue';
                else if (daysUntilService <= 30) urgency = 'urgent';
                else if (daysUntilService <= 90) urgency = 'upcoming';
                
                return { nextDate, daysUntilService, urgency };
            };

            const getUrgencyColor = (urgency) => {
                switch (urgency) {
                    case 'overdue': return 'bg-red-500';
                    case 'urgent': return 'bg-orange-500';
                    case 'upcoming': return 'bg-yellow-500';
                    default: return 'bg-green-500';
                }
            };

            const getUrgencyText = (daysUntilService) => {
                if (daysUntilService < 0) return `${Math.abs(daysUntilService)} days overdue`;
                if (daysUntilService === 0) return 'Due today';
                return `${daysUntilService} days until service`;
            };

            const JobForm = ({ job, onSave, onCancel }) => {
                const [formData, setFormData] = useState({
                    customerName: job?.customerName || '',
                    address: job?.address || '',
                    lat: job?.lat || '',
                    lng: job?.lng || '',
                    lastServiceDate: job?.lastServiceDate || '',
                    serviceInterval: job?.serviceInterval || 24,
                    phone: job?.phone || '',
                    email: job?.email || '',
                    tankSize: job?.tankSize || '',
                    notes: job?.notes || ''
                });

                const handleSubmit = () => {
                    onSave({
                        ...formData,
                        id: job?.id || Date.now(),
                        lat: parseFloat(formData.lat) || 39.7817,
                        lng: parseFloat(formData.lng) || -89.6501,
                        serviceInterval: parseInt(formData.serviceInterval)
                    });
                };

                return (
                    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
                        <div className="bg-white rounded-lg p-6 w-full max-w-md max-h-[90vh] overflow-y-auto">
                            <h3 className="text-lg font-semibold mb-4">
                                {job ? 'Edit Job' : 'Add New Job'}
                            </h3>
                            
                            <div className="space-y-4">
                                <div>
                                    <label className="block text-sm font-medium mb-1">Customer Name</label>
                                    <input
                                        type="text"
                                        value={formData.customerName}
                                        onChange={(e) => setFormData({...formData, customerName: e.target.value})}
                                        className="w-full p-2 border rounded-md focus:ring-2 focus:ring-blue-500"
                                        required
                                    />
                                </div>

                                <div>
                                    <label className="block text-sm font-medium mb-1">Address</label>
                                    <input
                                        type="text"
                                        value={formData.address}
                                        onChange={(e) => setFormData({...formData, address: e.target.value})}
                                        className="w-full p-2 border rounded-md focus:ring-2 focus:ring-blue-500"
                                        placeholder="123 Main St, City, State"
                                        required
                                    />
                                </div>

                                <div className="grid grid-cols-2 gap-4">
                                    <div>
                                        <label className="block text-sm font-medium mb-1">Phone</label>
                                        <input
                                            type="tel"
                                            value={formData.phone}
                                            onChange={(e) => setFormData({...formData, phone: e.target.value})}
                                            className="w-full p-2 border rounded-md focus:ring-2 focus:ring-blue-500"
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium mb-1">Tank Size</label>
                                        <input
                                            type="text"
                                            value={formData.tankSize}
                                            onChange={(e) => setFormData({...formData, tankSize: e.target.value})}
                                            className="w-full p-2 border rounded-md focus:ring-2 focus:ring-blue-500"
                                            placeholder="1000 gallons"
                                        />
                                    </div>
                                </div>

                                <div>
                                    <label className="block text-sm font-medium mb-1">Email</label>
                                    <input
                                        type="email"
                                        value={formData.email}
                                        onChange={(e) => setFormData({...formData, email: e.target.value})}
                                        className="w-full p-2 border rounded-md focus:ring-2 focus:ring-blue-500"
                                        placeholder="customer@email.com"
                                    />
                                </div>

                                <div>
                                    <label className="block text-sm font-medium mb-1">Last Service Date</label>
                                    <input
                                        type="date"
                                        value={formData.lastServiceDate}
                                        onChange={(e) => setFormData({...formData, lastServiceDate: e.target.value})}
                                        className="w-full p-2 border rounded-md focus:ring-2 focus:ring-blue-500"
                                        required
                                    />
                                </div>

                                <div>
                                    <label className="block text-sm font-medium mb-1">Service Interval (months)</label>
                                    <select
                                        value={formData.serviceInterval}
                                        onChange={(e) => setFormData({...formData, serviceInterval: e.target.value})}
                                        className="w-full p-2 border rounded-md focus:ring-2 focus:ring-blue-500"
                                    >
                                        <option value={12}>12 months</option>
                                        <option value={18}>18 months</option>
                                        <option value={24}>24 months</option>
                                        <option value={36}>36 months</option>
                                        <option value={48}>48 months</option>
                                    </select>
                                </div>

                                <div>
                                    <label className="block text-sm font-medium mb-1">Notes</label>
                                    <textarea
                                        value={formData.notes}
                                        onChange={(e) => setFormData({...formData, notes: e.target.value})}
                                        className="w-full p-2 border rounded-md h-20 focus:ring-2 focus:ring-blue-500"
                                        placeholder="Special instructions, access notes, etc."
                                    />
                                </div>

                                <div className="flex gap-2 pt-4">
                                    <button
                                        onClick={handleSubmit}
                                        className="flex-1 bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition-colors"
                                    >
                                        Save Job
                                    </button>
                                    <button
                                        onClick={onCancel}
                                        className="flex-1 bg-gray-300 text-gray-700 px-4 py-2 rounded-md hover:bg-gray-400 transition-colors"
                                    >
                                        Cancel
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            };

            const handleSaveJob = (jobData) => {
                if (editingJob) {
                    setJobs(jobs.map(job => job.id === editingJob.id ? jobData : job));
                    setEditingJob(null);
                } else {
                    setJobs([...jobs, jobData]);
                    setShowAddForm(false);
                }
            };

            const handleDeleteJob = (id) => {
                setJobs(jobs.filter(job => job.id !== id));
                setSelectedJob(null);
            };

            const sendEmailReminder = (job) => {
                alert(`üìß Email reminder sent to ${job.customerName} (${job.email})\n\nThis is a demo - in production, this would send a real email!`);
            };

            const urgentJobs = jobs.filter(job => {
                const { urgency } = calculateServiceInfo(job.lastServiceDate, job.serviceInterval);
                return urgency === 'overdue' || urgency === 'urgent';
            });

            return (
                <div className="max-w-7xl mx-auto p-4">
                    {/* Header */}
                    <div className="flex justify-between items-center mb-6">
                        <div>
                            <h1 className="text-3xl font-bold text-gray-800">Septic Tank Management</h1>
                            <p className="text-gray-600">Track and schedule septic tank cleanings</p>
                        </div>
                        
                        <div className="flex gap-4">
                            {urgentJobs.length > 0 && (
                                <div className="bg-red-100 border border-red-300 px-4 py-2 rounded-lg flex items-center gap-2">
                                    <span className="icon icon-bell"></span>
                                    <span className="text-red-700 font-medium">
                                        {urgentJobs.length} urgent job{urgentJobs.length !== 1 ? 's' : ''}
                                    </span>
                                </div>
                            )}
                            
                            <button
                                onClick={() => setShowAddForm(true)}
                                className="bg-blue-600 text-white px-4 py-2 rounded-lg flex items-center gap-2 hover:bg-blue-700 transition-colors"
                            >
                                <span className="icon icon-plus"></span>
                                Add Job
                            </button>
                        </div>
                    </div>

                    {/* Search Bar */}
                    <div className="mb-6">
                        <div className="relative max-w-md">
                            <div className="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                <span className="icon icon-search text-gray-400"></span>
                            </div>
                            <input
                                type="text"
                                value={searchTerm}
                                onChange={(e) => setSearchTerm(e.target.value)}
                                className="block w-full pl-10 pr-10 py-2 border border-gray-300 rounded-md leading-5 bg-white placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-1 focus:ring-blue-500 focus:border-blue-500"
                                placeholder="Search customers, addresses, phone, email..."
                            />
                            {searchTerm && (
                                <div className="absolute inset-y-0 right-0 pr-3 flex items-center">
                                    <button
                                        onClick={() => setSearchTerm('')}
                                        className="text-gray-400 hover:text-gray-600"
                                    >
                                        <span className="icon icon-x"></span>
                                    </button>
                                </div>
                            )}
                        </div>
                        {searchTerm && (
                            <p className="mt-2 text-sm text-gray-600">
                                Found {filteredJobs.length} result{filteredJobs.length !== 1 ? 's' : ''} for "{searchTerm}"
                            </p>
                        )}
                    </div>

                    {/* Main Content Grid */}
                    <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        {/* Map View */}
                        <div className="lg:col-span-2">
                            <div className="bg-white rounded-lg shadow-md p-4">
                                <h2 className="text-xl font-semibold mb-4 flex items-center gap-2">
                                    <span className="icon icon-map"></span>
                                    Job Locations
                                </h2>
                                
                                <div className="bg-blue-50 rounded-lg p-6 h-96 relative border-2 border-blue-200">
                                    <div className="text-center text-gray-500 mb-4">Springfield Area Map</div>
                                    
                                    {/* Map markers */}
                                    {filteredJobs.map(job => {
                                        const { urgency } = calculateServiceInfo(job.lastServiceDate, job.serviceInterval);
                                        const x = ((job.lng + 89.6520) * 2000) % 100;
                                        const y = ((job.lat - 39.7800) * 2000) % 100;
                                        
                                        return (
                                            <div
                                                key={job.id}
                                                className={`absolute w-4 h-4 rounded-full cursor-pointer ${getUrgencyColor(urgency)} border-2 border-white shadow-md hover:scale-150 transition-transform`}
                                                style={{ left: `${20 + x}%`, top: `${20 + y}%` }}
                                                onClick={() => setSelectedJob(job)}
                                                title={job.customerName}
                                            />
                                        );
                                    })}

                                    {/* Legend */}
                                    <div className="absolute bottom-4 left-4 bg-white p-3 rounded-lg shadow-md">
                                        <h4 className="font-medium text-sm mb-2">Legend</h4>
                                        <div className="space-y-1 text-xs">
                                            <div className="flex items-center gap-2">
                                                <div className="w-3 h-3 bg-red-500 rounded-full"></div>
                                                <span>Overdue</span>
                                            </div>
                                            <div className="flex items-center gap-2">
                                                <div className="w-3 h-3 bg-orange-500 rounded-full"></div>
                                                <span>Urgent (‚â§30 days)</span>
                                            </div>
                                            <div className="flex items-center gap-2">
                                                <div className="w-3 h-3 bg-yellow-500 rounded-full"></div>
                                                <span>Upcoming (‚â§90 days)</span>
                                            </div>
                                            <div className="flex items-center gap-2">
                                                <div className="w-3 h-3 bg-green-500 rounded-full"></div>
                                                <span>Normal</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        {/* Sidebar */}
                        <div className="space-y-6">
                            {/* Selected Job Details */}
                            {selectedJob && (
                                <div className="bg-white rounded-lg shadow-md p-4">
                                    <h3 className="text-lg font-semibold mb-3">Job Details</h3>
                                    <div className="space-y-3">
                                        <div>
                                            <h4 className="font-medium text-gray-700">{selectedJob.customerName}</h4>
                                            <p className="text-sm text-gray-600">{selectedJob.address}</p>
                                        </div>
                                        
                                        <div className="grid grid-cols-2 gap-4 text-sm">
                                            <div>
                                                <span className="text-gray-500">Phone:</span>
                                                <p>{selectedJob.phone}</p>
                                            </div>
                                            <div>
                                                <span className="text-gray-500">Email:</span>
                                                <p>{selectedJob.email}</p>
                                            </div>
                                        </div>

                                        <div className="grid grid-cols-2 gap-4 text-sm">
                                            <div>
                                                <span className="text-gray-500">Tank Size:</span>
                                                <p>{selectedJob.tankSize}</p>
                                            </div>
                                            <div>
                                                <span className="text-gray-500">Interval:</span>
                                                <p>{selectedJob.serviceInterval} months</p>
                                            </div>
                                        </div>

                                        <div className="text-sm">
                                            <span className="text-gray-500">Status:</span>
                                            <p className={`font-medium ${
                                                calculateServiceInfo(selectedJob.lastServiceDate, selectedJob.serviceInterval).urgency === 'overdue' ? 'text-red-600' :
                                                calculateServiceInfo(selectedJob.lastServiceDate, selectedJob.serviceInterval).urgency === 'urgent' ? 'text-orange-600' :
                                                calculateServiceInfo(selectedJob.lastServiceDate, selectedJob.serviceInterval).urgency === 'upcoming' ? 'text-yellow-600' :
                                                'text-green-600'
                                            }`}>
                                                {getUrgencyText(calculateServiceInfo(selectedJob.lastServiceDate, selectedJob.serviceInterval).daysUntilService)}
                                            </p>
                                        </div>

                                        {selectedJob.notes && (
                                            <div className="text-sm">
                                                <span className="text-gray-500">Notes:</span>
                                                <p className="italic">{selectedJob.notes}</p>
                                            </div>
                                        )}

                                        <div className="flex gap-2 pt-3">
                                            <button
                                                onClick={() => sendEmailReminder(selectedJob)}
                                                className="flex-1 bg-green-600 text-white px-3 py-2 rounded-md text-sm hover:bg-green-700 flex items-center justify-center gap-1 transition-colors"
                                            >
                                                <span className="icon icon-mail"></span>
                                                Send Reminder
                                            </button>
                                            <button
                                                onClick={() => setEditingJob(selectedJob)}
                                                className="flex-1 bg-blue-600 text-white px-3 py-2 rounded-md text-sm hover:bg-blue-700 flex items-center justify-center gap-1 transition-colors"
                                            >
                                                <span className="icon icon-edit"></span>
                                                Edit
                                            </button>
                                            <button
                                                onClick={() => handleDeleteJob(selectedJob.id)}
                                                className="flex-1 bg-red-600 text-white px-3 py-2 rounded-md text-sm hover:bg-red-700 flex items-center justify-center gap-1 transition-colors"
                                            >
                                                <span className="icon icon-delete"></span>
                                                Delete
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            )}

                            {/* Urgent Jobs List */}
                            <div className="bg-white rounded-lg shadow-md p-4">
                                <h3 className="text-lg font-semibold mb-3 flex items-center gap-2">
                                    <span className="icon icon-warning text-orange-500"></span>
                                    Urgent Jobs
                                </h3>
                                
                                {urgentJobs.length === 0 ? (
                                    <p className="text-gray-500 text-sm">No urgent jobs at this time.</p>
                                ) : (
                                    <div className="space-y-2">
                                        {urgentJobs.map(job => {
                                            const { daysUntilService, urgency } = calculateServiceInfo(job.lastServiceDate, job.serviceInterval);
                                            return (
                                                <div
                                                    key={job.id}
                                                    className="border-l-4 border-red-500 pl-3 py-2 bg-red-50 cursor-pointer hover:bg-red-100 transition-colors"
                                                    onClick={() => setSelectedJob(job)}
                                                >
                                                    <div className="font-medium text-sm">{job.customerName}</div>
                                                    <div className="text-xs text-gray-600">{job.address}</div>
                                                    <div className={`text-xs font-medium ${urgency === 'overdue' ? 'text-red-600' : 'text-orange-600'}`}>
                                                        {getUrgencyText(daysUntilService)}
                                                    </div>
                                                </div>
                                            );
                                        })}
                                    </div>
                                )}
                            </div>

                            {/* Quick Stats */}
                            <div className="bg-white rounded-lg shadow-md p-4">
                                <h3 className="text-lg font-semibold mb-3">Quick Stats</h3>
                                <div className="space-y-2 text-sm">
                                    <div className="flex justify-between">
                                        <span>Total Customers:</span>
                                        <span className="font-medium">{jobs.length}</span>
                                    </div>
                                    <div className="flex justify-between">
                                        <span>Urgent Jobs:</span>
                                        <span className="font-medium text-red-600">{urgentJobs.length}</span>
                                    </div>
                                    <div className="flex justify-between">
                                        <span>Search Results:</span>
                                        <span className="font-medium">{filteredJobs.length}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    {/* Forms */}
                    {showAddForm && (
                        <JobForm
                            onSave={handleSaveJob}
                            onCancel={() => setShowAddForm(false)}
                        />
                    )}

                    {editingJob && (
                        <JobForm
                            job={editingJob}
                            onSave={handleSaveJob}
                            onCancel={() => setEditingJob(null)}
                        />
                    )}
                </div>
            );
        };

        const App = () => {
            return React.createElement(SepticManagementSystem);
        };

        ReactDOM.render(React.createElement(App), document.getElementById('root'));
    </script>
</body>
</html>